# OneTrainer WebUI 部署与使用指南 (Headless Mode)

OneTrainer WebUI 是为远程服务器、无显示器环境（Headless）设计的浏览器界面。它允许你通过网页全面配置训练参数、监控实时进度、查看日志以及管理数据集。

## 1. 环境准备

- **Python**: 需要 Python 3.10 或 3.11 (建议与 OneTrainer 主环境一致)。
- **依赖**: WebUI 使用独立虚拟环境，首次启动会自动安装所需依赖。

## 2. 快速启动

在项目根目录下执行启动脚本：

```bash
chmod +x start-webui.sh
./start-webui.sh --host 0.0.0.0 --port 7860
```

### 启动参数说明：
- `--host`: 绑定的 IP 地址。`127.0.0.1` 仅限本地访问，`0.0.0.0` 允许远程访问。
- `--port`: 服务端口，默认为 `7860`。
- `--token`: (可选) 设置访问口令，增强安全性。

## 3. 远程访问方式

### 方案 A：SSH 端口转发 (推荐)
如果你在远程服务器上运行，且不想开放防火墙端口，可以使用 SSH 转发：
```bash
ssh -L 7860:127.0.0.1:7860 user@your-server-ip
```
然后在本机浏览器访问 `http://127.0.0.1:7860`。

### 方案 B：直接访问
如果你已开放服务器防火墙端口，且启动时指定了 `--host 0.0.0.0`，可直接访问：
`http://your-server-ip:7860`

## 4. 安全配置 (Token 鉴权)

为了防止他人未经授权访问你的训练界面，建议启用 Token 模式：

```bash
# 设置环境变量
export OT_WEBUI_TOKEN="你的安全密码"
./start-webui.sh --host 0.0.0.0 --port 7860
```

启动后，访问地址需带上 token：
`http://your-server-ip:7860/?token=你的安全密码`

## 5. 功能详解

### Dashboard (仪表盘)
- **实时监控**: 查看当前的训练状态、Step 进度、系统负载 (CPU/GPU/RAM)。
- **日志查看**: 实时滚动显示训练日志，支持调整查看的日志大小。
- **训练控制**: 快速启动或停止训练任务。

### Configuration (参数配置)
- **全参数覆盖**: 提供 OneTrainer 所有的训练配置项，无需手动编辑 JSON。
- **智能联动**: 
  - 自动根据模型路径识别 `Model Type`。
  - 根据选中的 `Optimizer` 或 `PEFT Type` (如 LoKr, LoRA) 动态显示/隐藏相关参数。
- **配置保存**: 修改后的参数会实时保存到服务器，支持一键加载历史配置。

### Dataset Tools (数据集工具)
- **完整性检查**: 快速扫描数据集路径是否存在、图片数量是否正确、Prompt 文件是否匹配。

## 6. 常见问题 (FAQ)

- **Q: 为什么我修改了参数没生效？**
  - A: 请确保在修改参数后点击了“Save Config to File”，然后再点击“Start Training”。
- **Q: 训练过程中可以修改参数吗？**
  - A: 训练开始后，参数会被锁定到当前 Run。修改参数需停止并重新开始。
- **Q: 端口被占用怎么办？**
  - A: 使用 `fuser -k 7860/tcp` 杀死占用进程，或在启动时指定不同的 `--port`。

---
*注：WebUI 代码位于 `modules/webui`，数据和日志默认存储在 `.ot-webui` 目录下。*
